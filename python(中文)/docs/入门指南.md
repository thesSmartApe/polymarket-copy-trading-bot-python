# 入门指南

设置和使用 Polymarket 跟单交易机器人的完整逐步指南。

## 目录

1. [先决条件](#先决条件)
2. [安装](#安装)
3. [初始设置](#初始设置)
4. [配置](#配置)
5. [首次运行](#首次运行)
6. [查找交易者](#查找交易者)
7. [运行机器人](#运行机器人)
8. [监控](#监控)
9. [故障排除](#故障排除)

## 先决条件

在开始之前，请确保您拥有：

### 1. Python 3.10 或更高版本

检查您的 Python 版本：
```bash
python --version
# 或
python3 --version
```

如果您没有 Python 3.10+，请从 [python.org](https://www.python.org/downloads/) 下载。

### 2. MongoDB 数据库

您需要一个 MongoDB 数据库来存储交易历史。选项：

**选项 A：MongoDB Atlas（推荐 - 提供免费版）**
1. 访问 [MongoDB Atlas](https://www.mongodb.com/cloud/atlas/register)
2. 创建免费账户
3. 创建新集群（免费版：M0）
4. 创建数据库用户
5. 将您的 IP 地址加入白名单（或使用 `0.0.0.0/0` 用于开发）
6. 获取连接字符串：`mongodb+srv://<username>:<password>@cluster.mongodb.net/`

**选项 B：本地 MongoDB**
```bash
# 本地安装 MongoDB
# Windows: 从 mongodb.com 下载
# macOS: brew install mongodb-community
# Linux: sudo apt-get install mongodb
```

### 3. Polygon 钱包

您需要一个 Polygon 钱包，包含：
- **USDC** 用于交易（测试时从小额开始）
- **POL/MATIC** 用于 gas 费用（推荐：1-2 MATIC）

**创建钱包：**
- 使用 MetaMask、Trust Wallet 或任何兼容 Polygon 的钱包
- 导出您的私钥（请妥善保管！）
- 为钱包充值 USDC 和 MATIC

### 4. RPC 端点

您需要一个 Polygon RPC 端点。选项：

**选项 A：Alchemy（推荐 - 免费版）**
1. 访问 [Alchemy](https://www.alchemy.com)
2. 创建免费账户
3. 在 Polygon 网络上创建新应用
4. 复制您的 HTTP URL：`https://polygon-mainnet.g.alchemy.com/v2/YOUR_API_KEY`

**选项 B：Infura（免费版）**
1. 访问 [Infura](https://infura.io)
2. 创建免费账户
3. 创建新项目
4. 选择 Polygon 网络
5. 复制您的端点：`https://polygon-mainnet.infura.io/v3/YOUR_PROJECT_ID`

**选项 C：公共 RPC（不推荐用于生产）**
- `https://polygon-rpc.com`
- `https://rpc-mainnet.matic.network`

## 安装

### 步骤 1：克隆仓库

```bash
git clone https://github.com/thesSmartApe/polymarket-copy-trading-bot-python.git
cd polymarket-copy-trading-bot-python/python
```

### 步骤 2：安装依赖

```bash
# 创建虚拟环境（推荐）
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 步骤 3：验证安装

```bash
# 检查 Python 版本
python --version

# 验证已安装的包
pip list | grep -E "web3|pymongo|httpx|colorama"
```

## 初始设置

### 运行设置向导

交互式设置向导将引导您完成配置：

```bash
python -m src.scripts.setup.setup
```

向导将询问：

1. **MongoDB URI**
   - 输入您的 MongoDB 连接字符串
   - 示例：`mongodb+srv://user:pass@cluster.mongodb.net/`

2. **RPC URL**
   - 输入您的 Polygon RPC 端点
   - 示例：`https://polygon-mainnet.g.alchemy.com/v2/YOUR_KEY`

3. **钱包地址**
   - 您的 Polygon 钱包地址（0x...）
   - 这是执行交易的地方

4. **私钥**
   - 您的钱包私钥（无 0x 前缀）
   - ⚠️ **请妥善保管！永远不要分享！**

5. **USDC 合约地址**
   - 默认：`0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174`（Polygon USDC）
   - 按 Enter 使用默认值

6. **CLOB HTTP URL**
   - 默认：`https://clob.polymarket.com`
   - 按 Enter 使用默认值

7. **交易者地址**
   - 输入要复制的交易者钱包地址（逗号分隔）
   - 示例：`0xABC...,0xDEF...`
   - 您可以稍后添加更多

8. **交易倍数**
   - 默认：`1.0`（与交易者相同大小）
   - `2.0` = 交易者仓位大小的 2 倍
   - `0.5` = 交易者仓位大小的一半

9. **获取间隔**
   - 默认：`1` 秒
   - 检查新交易的频率

10. **交易聚合**
    - 启用以合并多个小交易
    - 默认：`false`

向导将使用您的配置创建 `.env` 文件。

## 配置

### 环境变量

您的 `.env` 文件包含所有配置。以下是每个变量的作用：

| 变量 | 描述 | 示例 |
|----------|-------------|---------|
| `MONGO_URI` | MongoDB 连接字符串 | `mongodb+srv://...` |
| `RPC_URL` | Polygon RPC 端点 | `https://polygon-mainnet...` |
| `PROXY_WALLET` | 您的钱包地址 | `0x1234...` |
| `PRIVATE_KEY` | 钱包私钥 | `abc123...`（无 0x） |
| `USDC_CONTRACT_ADDRESS` | USDC 合约 | `0x2791Bca1f2de4661...` |
| `CLOB_HTTP_URL` | Polymarket CLOB API | `https://clob.polymarket.com` |
| `USER_ADDRESSES` | 要复制的交易者 | `0xABC...,0xDEF...` |
| `TRADE_MULTIPLIER` | 仓位大小倍数 | `1.0` |
| `FETCH_INTERVAL` | 检查间隔（秒） | `1` |
| `TRADE_AGGREGATION_ENABLED` | 启用聚合 | `false` |
| `TRADE_AGGREGATION_WINDOW_SECONDS` | 聚合窗口 | `30` |

### 编辑配置

您可以直接编辑 `.env` 或再次运行设置向导：

```bash
# 手动编辑
nano .env  # 或使用任何文本编辑器

# 或再次运行设置
python -m src.scripts.setup.setup
```

## 首次运行

### 步骤 1：验证系统状态

在启动机器人之前，验证所有配置是否正确：

```bash
python -m src.scripts.setup.system_status
```

这将检查：
- ✅ MongoDB 连接
- ✅ RPC 端点连接性
- ✅ 钱包余额（USDC 和 MATIC）
- ✅ CLOB API 可访问性
- ✅ 交易者地址有效性

**在继续之前修复任何问题！**

### 步骤 2：检查钱包余额

```bash
# 检查您的钱包统计信息
python -m src.scripts.wallet.check_my_stats

# 具体检查 USDC 余额
python -m src.scripts.wallet.check_proxy_wallet
```

确保您有：
- 至少 10-50 USDC 用于测试
- 1-2 MATIC 用于 gas 费用

### 步骤 3：验证授权

机器人需要您的许可才能使用 USDC：

```bash
# 检查当前授权
python -m src.scripts.wallet.check_allowance

# 如果需要，设置授权
python -m src.scripts.wallet.check_allowance
# 按照提示批准
```

## 查找交易者

### 方法 1：Polymarket 排行榜

1. 访问 [Polymarket 排行榜](https://polymarket.com/leaderboard)
2. 寻找具有以下特征的交易者：
   - 正盈亏
   - 胜率 > 55%
   - 活跃的交易历史
   - 一致的表现
3. 点击交易者查看其钱包地址
4. 复制地址（0x...）

### 方法 2：Predictfolio

1. 访问 [Predictfolio](https://predictfolio.com)
2. 浏览顶级表现者
3. 检查详细统计：
   - ROI
   - 胜率
   - 最大回撤
   - 夏普比率
4. 复制钱包地址

### 方法 3：使用机器人工具

机器人包含查找交易者的工具：

```bash
# 查找表现最佳的交易者
python -m src.scripts.research.find_best_traders

# 查找低风险交易者
python -m src.scripts.research.find_low_risk_traders

# 扫描市场中的活跃交易者
python -m src.scripts.research.scan_traders_from_markets
```

### 添加交易者

将交易者地址添加到您的 `.env` 文件：

```bash
USER_ADDRESSES=0x7c3db723f1d4d8cb9c550095203b686cb11e5c6b,0x6bab41a0dc40d6dd4c1a915b8c01969479fd1292
```

或使用设置向导进行更新。

## 运行机器人

### 启动机器人

```bash
python -m src.main
```

您应该看到：
- 机器人启动横幅
- 系统状态检查
- 已连接到 MongoDB
- 监控交易者...
- 准备复制交易

### 机器人行为

机器人将：
1. 每秒监控交易者活动
2. 检测跟踪交易者新开的仓位
3. 根据您的余额计算仓位大小
4. 自动执行匹配订单
5. 将所有活动记录到控制台和 `logs/` 目录

### 停止机器人

按 `Ctrl+C` 优雅停止。机器人将：
- 完成当前操作
- 关闭数据库连接
- 保存状态
- 干净退出

## 监控

### 检查最近的活动

```bash
# 查看最近的交易
python -m src.scripts.wallet.check_recent_activity

# 查看详细的仓位
python -m src.scripts.wallet.check_positions_detailed

# 检查盈亏
python -m src.scripts.wallet.check_pnl_discrepancy
```

### 查看统计信息

```bash
# 整体钱包统计信息
python -m src.scripts.wallet.check_my_stats
```

### 检查日志

日志保存在 `logs/` 目录中：

```bash
# 查看最新日志
cat logs/bot-$(date +%Y-%m-%d).log

# Windows PowerShell
Get-Content logs\bot-$(Get-Date -Format "yyyy-MM-dd").log
```

## 故障排除

### 常见问题

**1. MongoDB 连接失败**
```
Error: Failed to connect to MongoDB
```
**解决方案：**
- 验证 `.env` 中的 `MONGO_URI`
- 检查 MongoDB Atlas 中的 IP 白名单
- 测试连接：`python -m src.scripts.setup.system_status`

**2. RPC 连接失败**
```
Error: RPC endpoint not responding
```
**解决方案：**
- 验证 `.env` 中的 `RPC_URL`
- 检查 API 密钥是否有效
- 尝试不同的 RPC 端点

**3. 余额不足**
```
Error: Insufficient USDC balance
```
**解决方案：**
- 向钱包添加 USDC
- 检查余额：`python -m src.scripts.wallet.check_my_stats`
- 确保有 MATIC 用于 gas

**4. 机器人未检测到交易**
```
No trades detected
```
**解决方案：**
- 验证交易者地址是否正确
- 检查交易者是否在积极交易
- 验证 `.env` 中的 `USER_ADDRESSES`
- 检查最近的活动：`python -m src.scripts.wallet.check_recent_activity`

**5. 导入错误**
```
ModuleNotFoundError: No module named 'src'
```
**解决方案：**
- 从项目根目录运行命令
- 确保您在正确的目录中：`cd polymarket-copy-trading-bot`
- 如果使用虚拟环境，请激活它

### 获取帮助

```bash
# 查看所有可用命令
python -m src.scripts.setup.help

# 检查系统状态
python -m src.scripts.setup.system_status
```

### 下一步

- 阅读 [命令参考指南](命令参考.md)
- 了解 [高级功能](ADVANCED_FEATURES.md)
- 查看 [示例](示例.md)

---

**⚠️ 重要提醒：**
- 从小额开始测试
- 定期监控机器人
- 只交易您能承受损失的资金
- 妥善保管您的私钥
- 在复制之前研究交易者
