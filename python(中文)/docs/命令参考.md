# 命令参考指南

Polymarket 跟单交易机器人所有可用命令的完整参考。

## 目录

1. [设置和配置](#设置和配置)
2. [主机器人](#主机器人)
3. [钱包管理](#钱包管理)
4. [仓位管理](#仓位管理)
5. [交易者研究](#交易者研究)
6. [模拟和分析](#模拟和分析)
7. [快速参考](#快速参考)

## 设置和配置

### 交互式设置向导

```bash
python -m src.scripts.setup.setup
```

**用途：** 引导式配置向导，用于创建 `.env` 文件

**功能：**
- 提示所有必需的配置
- 验证输入（地址、密钥等）
- 使用您的设置创建 `.env` 文件
- 提供有用的默认值

**何时使用：**
- 首次设置
- 更改配置
- 添加新交易者

**示例：**
```bash
$ python -m src.scripts.setup.setup

[INFO] Starting setup wizard...
Enter MongoDB URI: mongodb+srv://user:pass@cluster.mongodb.net/
Enter RPC URL: https://polygon-mainnet.g.alchemy.com/v2/YOUR_KEY
...
[OK] Setup complete!
```

---

### 系统状态检查

```bash
python -m src.scripts.setup.system_status
```

**用途：** 验证系统配置和连接

**检查内容：**
- ✅ MongoDB 连接
- ✅ RPC 端点连接性
- ✅ 钱包余额（USDC 和 MATIC）
- ✅ CLOB API 可访问性
- ✅ 交易者地址有效性

**何时使用：**
- 启动机器人之前
- 故障排除连接问题
- 验证配置更改

**示例输出：**
```
[✓] MongoDB: Connected successfully
[✓] RPC: Connected to Polygon network
[✓] Wallet Balance: 100.50 USDC, 1.25 MATIC
[✓] CLOB API: Accessible
[✓] Traders: 2 addresses configured
```

---

### 帮助命令

```bash
python -m src.scripts.setup.help
```

**用途：** 显示所有可用命令和用法

**显示内容：**
- 所有可用命令
- 命令类别
- 快速开始指南
- 重要提醒

**何时使用：**
- 学习可用命令
- 快速参考
- 入门

---

## 主机器人

### 启动交易机器人

```bash
python -m src.main
```

**用途：** 启动跟单交易机器人

**功能：**
- 连接到 MongoDB
- 初始化 CLOB 客户端
- 开始监控交易者活动
- 自动执行交易

**何时使用：**
- 设置完成后
- 开始复制交易
- 停止后恢复交易

**示例：**
```bash
$ python -m src.main

========================================
  POLYMARKET COPY TRADING BOT
========================================

[INFO] Connecting to MongoDB...
[OK] Connected to database
[INFO] Monitoring traders: 0xABC..., 0xDEF...
[INFO] Bot is running. Press Ctrl+C to stop.
```

**停止：** 按 `Ctrl+C` 优雅关闭

---

## 钱包管理

### 检查代理钱包

```bash
python -m src.scripts.wallet.check_proxy_wallet
```

**用途：** 检查代理钱包余额和仓位

**显示内容：**
- USDC 余额
- MATIC 余额
- 活跃仓位
- 最近活动

**何时使用：**
- 验证钱包资金
- 检查当前仓位
- 监控余额变化

---

### 检查两个钱包

```bash
python -m src.scripts.wallet.check_both_wallets <address1> <address2>
```

**用途：** 比较两个钱包地址

**显示内容：**
- 余额比较
- 仓位比较
- 活动比较

**何时使用：**
- 比较交易者与您的钱包
- 分析不同钱包
- 研究目的

**示例：**
```bash
python -m src.scripts.wallet.check_both_wallets 0xABC... 0xDEF...
```

---

### 检查我的统计信息

```bash
python -m src.scripts.wallet.check_my_stats
```

**用途：** 查看全面的钱包统计信息

**显示内容：**
- 总余额
- 活跃仓位
- 盈亏摘要
- 交易统计
- 最近活动摘要

**何时使用：**
- 定期性能检查
- 快速状态概览
- 监控进度

---

### 检查最近活动

```bash
python -m src.scripts.wallet.check_recent_activity
```

**用途：** 查看最近的交易活动

**显示内容：**
- 最近的交易
- 仓位开仓/平仓
- 时间戳
- 市场信息

**何时使用：**
- 验证机器人是否工作
- 查看最近的交易
- 调试

---

### 检查详细仓位

```bash
python -m src.scripts.wallet.check_positions_detailed
```

**用途：** 查看详细的仓位信息

**显示内容：**
- 所有未平仓仓位
- 仓位详情（市场、结果、大小）
- 当前价值
- 每个仓位的盈亏

**何时使用：**
- 详细的仓位分析
- 管理仓位
- 平仓前审查

---

### 检查盈亏差异

```bash
python -m src.scripts.wallet.check_pnl_discrepancy
```

**用途：** 分析盈亏差异

**显示内容：**
- 预期与实际盈亏
- 差异分析
- 潜在问题

**何时使用：**
- 验证机器人准确性
- 调试盈亏问题
- 性能审计

---

### 验证授权

```bash
python -m src.scripts.wallet.verify_allowance
```

**用途：** 验证 USDC 代币授权

**显示内容：**
- 当前授权
- 所需授权
- 批准状态

**何时使用：**
- 启动机器人之前
- 故障排除交易失败
- 更改钱包后

---

### 检查授权

```bash
python -m src.scripts.wallet.check_allowance
```

**用途：** 检查并设置 USDC 授权

**功能：**
- 检查当前授权
- 如果不足则提示设置
- 引导完成批准过程

**何时使用：**
- 初始设置
- 授权过期后
- 设置新授权

**示例：**
```bash
$ python -m src.scripts.wallet.check_allowance

Current allowance: 0 USDC
Required: 1000 USDC
[?] Set allowance? (y/n): y
[INFO] Approving USDC...
[OK] Allowance set successfully
```

---

### 设置代币授权

```bash
python -m src.scripts.wallet.set_token_allowance
```

**用途：** 设置 ERC1155 代币授权

**功能：**
- 为 Polymarket 代币设置授权
- 仓位管理所需

**何时使用：**
- 卖出仓位之前
- 平仓之前
- 仓位管理设置

---

### 查找我的 EOA

```bash
python -m src.scripts.wallet.find_my_eoa
```

**用途：** 查找和分析 EOA 钱包

**显示内容：**
- EOA 钱包地址
- 钱包类型
- 关联地址

**何时使用：**
- 了解钱包结构
- 故障排除
- 研究

---

### 查找 Gnosis Safe 代理

```bash
python -m src.scripts.wallet.find_gnosis_safe_proxy
```

**用途：** 查找 Gnosis Safe 代理钱包

**显示内容：**
- 代理钱包地址
- Safe 地址
- 钱包结构

**何时使用：**
- 使用 Gnosis Safe
- 多重签名设置
- 高级钱包管理

---

## 仓位管理

⚠️ **注意：** 这些命令需要完整的 CLOB 客户端实现。

### 手动卖出

```bash
python -m src.scripts.position.manual_sell <market_id> <outcome> <amount>
```

**用途：** 手动卖出特定仓位

**参数：**
- `market_id`: 市场标识符
- `outcome`: 要卖出的结果（YES/NO）
- `amount`: 卖出数量

**何时使用：**
- 手动仓位管理
- 紧急退出
- 部分仓位平仓

---

### 卖出大仓位

```bash
python -m src.scripts.position.sell_large_positions
```

**用途：** 自动卖出大仓位

**功能：**
- 识别大仓位
- 自动卖出
- 风险管理

**何时使用：**
- 降低风险
- 投资组合再平衡
- 自动化仓位管理

---

### 关闭陈旧仓位

```bash
python -m src.scripts.position.close_stale_positions
```

**用途：** 关闭陈旧/旧仓位

**功能：**
- 查找旧仓位
- 自动关闭
- 清理工具

**何时使用：**
- 投资组合清理
- 移除旧仓位
- 维护

---

### 关闭已解决仓位

```bash
python -m src.scripts.position.close_resolved_positions
```

**用途：** 关闭已解决的市场仓位

**功能：**
- 查找已解决的市场
- 关闭仓位
- 收集奖金

**何时使用：**
- 市场解决后
- 收集奖金
- 清理

---

### 赎回已解决仓位

```bash
python -m src.scripts.position.redeem_resolved_positions
```

**用途：** 赎回已解决仓位

**功能：**
- 赎回获胜仓位
- 收集付款
- 区块链交互

**何时使用：**
- 市场解决后
- 收集付款
- 最终结算

---

## 交易者研究

### 查找最佳交易者

```bash
python -m src.scripts.research.find_best_traders
```

**用途：** 查找表现最佳的交易者

**显示内容：**
- 按 ROI 排序的顶级交易者
- 性能指标
- 交易统计
- 排名表

**何时使用：**
- 查找要复制的交易者
- 研究
- 性能分析

**示例输出：**
```
Rank | Address          | ROI    | Win Rate | P&L
-----|------------------|--------|----------|-----
1    | 0x7c3d...        | 45.2%  | 62.5%    | $1,234
2    | 0x6bab...        | 38.7%  | 58.3%    | $987
```

---

### 查找低风险交易者

```bash
python -m src.scripts.research.find_low_risk_traders
```

**用途：** 查找具有良好指标的低风险交易者

**显示内容：**
- 低风险交易者
- 风险指标（夏普、回撤）
- 保守表现者
- 按风险标准筛选

**何时使用：**
- 保守策略
- 风险厌恶交易
- 稳定表现者

---

### 扫描最佳交易者

```bash
python -m src.scripts.research.scan_best_traders
```

**用途：** 扫描和分析顶级交易者

**功能：**
- 扫描活跃市场
- 识别顶级交易者
- 分析性能
- 生成报告

**何时使用：**
- 市场研究
- 查找活跃交易者
- 性能发现

---

### 从市场扫描交易者

```bash
python -m src.scripts.research.scan_traders_from_markets
```

**用途：** 从活跃市场扫描交易者

**功能：**
- 扫描活跃市场
- 提取交易者地址
- 分析活动
- 生成列表

**何时使用：**
- 基于市场的发现
- 查找活跃交易者
- 研究

---

## 模拟和分析

### 模拟盈利能力

```bash
python -m src.scripts.simulation.simulate_profitability
```

**用途：** 模拟交易者的盈利能力

**功能：**
- 获取交易者历史
- 模拟复制交易
- 计算 ROI、盈亏
- 生成报告

**何时使用：**
- 复制交易者之前
- 性能测试
- 策略验证

**示例：**
```bash
$ python -m src.scripts.simulation.simulate_profitability

Enter trader address: 0x7c3db723f1d4d8cb9c550095203b686cb11e5c6b
Simulating 30 days...
[OK] Simulation complete
ROI: 12.5%
Total P&L: $125.50
Win Rate: 58.3%
```

---

### 模拟盈利能力（旧逻辑）

```bash
python -m src.scripts.simulation.simulate_profitability_old
```

**用途：** 旧模拟算法（遗留）

**功能：**
- 使用遗留模拟逻辑
- 不同的仓位大小
- 历史比较

**何时使用：**
- 比较算法
- 历史分析
- 遗留测试

---

### 运行模拟

```bash
python -m src.scripts.simulation.run_simulations [preset] [options]
```

**用途：** 运行全面的批量模拟

**预设：**
- `quick` - 7 天，2 个倍数
- `standard` - 30 天，3 个倍数（推荐）
- `full` - 90 天，4 个倍数
- `custom` - 自定义参数

**何时使用：**
- 全面测试
- 多个交易者
- 策略比较

**示例：**
```bash
# 快速模拟
python -m src.scripts.simulation.run_simulations quick

# 标准模拟
python -m src.scripts.simulation.run_simulations standard

# 自定义模拟
python -m src.scripts.simulation.run_simulations custom 0xABC... 30 2.0
```

---

### 比较结果

```bash
python -m src.scripts.simulation.compare_results [mode] [options]
```

**用途：** 比较模拟结果

**模式：**
- （无参数）- 显示所有结果
- `best [N]` - 显示前 N 个结果
- `worst [N]` - 显示最差 N 个结果
- `stats` - 聚合统计
- `detail <name>` - 详细视图

**何时使用：**
- 分析模拟
- 查找最佳策略
- 性能比较

**示例：**
```bash
# 显示所有结果
python -m src.scripts.simulation.compare_results

# 显示前 5 个
python -m src.scripts.simulation.compare_results best 5

# 详细视图
python -m src.scripts.simulation.compare_results detail std_m2p0
```

---

### 聚合结果

```bash
python -m src.scripts.simulation.aggregate_results
```

**用途：** 跨策略聚合交易结果

**功能：**
- 扫描结果目录
- 聚合统计
- 生成摘要报告
- 保存到 `strategy_factory_results/`

**何时使用：**
- 全面分析
- 策略比较
- 性能摘要

---

### 审计跟单交易

```bash
python -m src.scripts.simulation.audit_copy_trading
```

**用途：** 审计跟单交易算法性能

**功能：**
- 模拟交易
- 与实际机器人比较
- 识别差异
- 生成审计报告

**何时使用：**
- 性能验证
- 算法验证
- 调试

---

### 获取历史交易

```bash
python -m src.scripts.simulation.fetch_historical_trades
```

**用途：** 获取并缓存历史交易数据

**功能：**
- 获取交易者历史
- 缓存到 `trader_data_cache/`
- 支持并行处理
- 处理速率限制

**何时使用：**
- 数据收集
- 为模拟预缓存
- 历史分析

**选项：**
- `--force` - 强制刷新（绕过缓存）
- `--days N` - 要获取的天数

---

## 快速参考

### 最常用命令

```bash
# 设置
python -m src.scripts.setup.setup              # 初始设置
python -m src.scripts.setup.system_status       # 检查状态

# 交易
python -m src.main                              # 启动机器人

# 监控
python -m src.scripts.wallet.check_my_stats     # 查看统计
python -m src.scripts.wallet.check_recent_activity # 最近交易

# 研究
python -m src.scripts.research.find_best_traders # 查找交易者
python -m src.scripts.simulation.simulate_profitability # 测试交易者
```

### 命令类别

| 类别 | 命令 |
|----------|----------|
| 设置 | `setup.setup`, `setup.system_status`, `setup.help` |
| 钱包 | `wallet.check_*`, `wallet.verify_*`, `wallet.find_*` |
| 仓位 | `position.manual_sell`, `position.close_*`, `position.redeem_*` |
| 研究 | `research.find_*`, `research.scan_*` |
| 模拟 | `simulation.simulate_*`, `simulation.run_*`, `simulation.compare_*` |

### 获取帮助

```bash
# 查看所有命令
python -m src.scripts.setup.help

# 检查系统状态
python -m src.scripts.setup.system_status
```

---

有关更多详细信息，请参阅：
- [入门指南](入门指南.md)
- [示例](示例.md)
- [高级功能](ADVANCED_FEATURES.md)
