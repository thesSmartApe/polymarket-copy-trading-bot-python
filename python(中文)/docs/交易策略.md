# 跟单交易策略指南

理解和配置跟单交易机器人策略系统的完整指南。

## 目录

1. [策略概述](#策略概述)
2. [策略类型](#策略类型)
3. [仓位大小逻辑](#仓位大小逻辑)
4. [倍数](#倍数)
5. [安全限制](#安全限制)
6. [交易聚合](#交易聚合)
7. [配置示例](#配置示例)
8. [推荐策略](#推荐策略)
9. [高级配置](#高级配置)

## 策略概述

Polymarket 跟单交易机器人使用复杂的策略系统来确定在复制跟踪交易者的交易时分配多少资金。策略系统包括：

1. **基础策略** - 如何计算初始订单大小
2. **倍数** - 基于交易大小的可选缩放因子
3. **安全限制** - 最大和最小约束
4. **交易聚合** - 合并多个小交易

### 工作原理

当跟踪的交易者开新仓位时，机器人：

1. **检测交易** - 实时监控交易者活动
2. **计算基础大小** - 使用您配置的策略确定初始订单大小
3. **应用倍数** - 根据交易大小缩放订单（如果已配置）
4. **应用限制** - 确保订单符合安全约束
5. **检查余额** - 验证有足够的资金
6. **执行订单** - 在 Polymarket 上放置交易

## 策略类型

机器人支持三种主要策略类型：

### 1. PERCENTAGE 策略

**描述：** 复制交易者订单大小的固定百分比。

**最适合：**
- 相对于交易者的一致仓位大小
- 按比例的风险管理
- 最常见的用例

**配置：**
```env
COPY_STRATEGY=PERCENTAGE
COPY_SIZE=10.0  # 复制交易者订单的 10%
```

**示例：**
- 交易者开 $100 仓位
- 您的订单：$100 × 10% = **$10**

**用例：**
- 小到中等余额
- 想要按比例的风险敞口
- 跟踪多个交易者

---

### 2. FIXED 策略

**描述：** 无论交易者的订单大小如何，都复制固定的美元金额。

**最适合：**
- 一致的仓位大小
- 风险控制
- 小余额管理

**配置：**
```env
COPY_STRATEGY=FIXED
COPY_SIZE=50.0  # 始终复制 $50
```

**示例：**
- 交易者开 $100 仓位 → 您的订单：**$50**
- 交易者开 $500 仓位 → 您的订单：**$50**
- 交易者开 $10 仓位 → 您的订单：**$50**（如果在限制内）

**用例：**
- 有限资金
- 想要每笔交易固定风险
- 保守方法

---

### 3. ADAPTIVE 策略

**描述：** 根据交易者的订单大小动态调整百分比。

**最适合：**
- 大余额
- 复杂的风险管理
- 优化仓位大小

**工作原理：**
- **小订单**（< 阈值）：使用更高百分比
- **大订单**（> 阈值）：使用更低百分比
- **中等订单**：线性插值

**配置：**
```env
COPY_STRATEGY=ADAPTIVE
COPY_SIZE=10.0              # 基础百分比
ADAPTIVE_MIN_PERCENT=5.0    # 大订单的最小值
ADAPTIVE_MAX_PERCENT=15.0   # 小订单的最大值
ADAPTIVE_THRESHOLD_USD=500.0  # 美元阈值
```

**阈值 = $500 的示例：**
- 交易者开 $50 订单 → 您的订单：~15% = **$7.50**（更高 %）
- 交易者开 $500 订单 → 您的订单：~10% = **$50**（基础 %）
- 交易者开 $2000 订单 → 您的订单：~5% = **$100**（更低 %）

**用例：**
- 大余额（$2000+）
- 想要在大交易上缩小规模
- 优化风险/回报

## 仓位大小逻辑

机器人通过多步骤过程计算订单大小：

### 步骤 1：计算基础金额

根据您的策略：
- **PERCENTAGE**：`base = trader_size × (copy_size / 100)`
- **FIXED**：`base = copy_size`
- **ADAPTIVE**：`base = trader_size × (adaptive_percent / 100)`

### 步骤 2：应用倍数

如果已配置倍数：
- **单一倍数**：`amount = base × multiplier`
- **分层倍数**：`amount = base × tier_multiplier`（基于交易者的订单大小）

### 步骤 3：应用最大订单大小限制

```python
if amount > MAX_ORDER_SIZE_USD:
    amount = MAX_ORDER_SIZE_USD
```

### 步骤 4：应用最大仓位大小限制

如果已配置，确保总仓位不超过限制：
```python
if (current_position + amount) > MAX_POSITION_SIZE_USD:
    amount = MAX_POSITION_SIZE_USD - current_position
```

### 步骤 5：检查可用余额

使用 1% 安全缓冲：
```python
max_affordable = balance × 0.99
if amount > max_affordable:
    amount = max_affordable
```

### 步骤 6：检查最小订单大小

```python
if amount < MIN_ORDER_SIZE_USD:
    # 订单太小，可能跳过
    amount = MIN_ORDER_SIZE_USD
```

## 倍数

倍数允许您根据交易大小缩放订单。支持两种类型：

### 单一倍数

应用于所有交易的简单缩放因子。

**配置：**
```env
TRADE_MULTIPLIER=2.0  # 所有订单 2 倍
```

**示例：**
- 基础订单：$10
- 使用 2.0x 倍数：**$20**

**用例：**
- 简单缩放
- 统一放大
- 快速配置

---

### 分层倍数

基于交易者订单大小的不同倍数。更复杂的风险管理。

**配置：**
```env
TIERED_MULTIPLIERS=1-10:2.0,10-100:1.0,100-500:0.5,500+:0.2
```

**格式：** `min-max:multiplier` 或 `min+:multiplier`

**示例分解：**
- `1-10:2.0` - $1-$10 订单：2x 倍数
- `10-100:1.0` - $10-$100 订单：1x 倍数（无变化）
- `100-500:0.5` - $100-$500 订单：0.5x 倍数（一半大小）
- `500+:0.2` - $500+ 订单：0.2x 倍数（20% 大小）

**计算示例：**
- 交易者开 $5 订单
  - 基础：$5 × 10% = $0.50
  - 层级：1-10 → 2.0x 倍数
  - 最终：$0.50 × 2.0 = **$1.00**

- 交易者开 $200 订单
  - 基础：$200 × 10% = $20
  - 层级：100-500 → 0.5x 倍数
  - 最终：$20 × 0.5 = **$10.00**

- 交易者开 $1000 订单
  - 基础：$1000 × 10% = $100
  - 层级：500+ → 0.2x 倍数
  - 最终：$100 × 0.2 = **$20.00**

**用例：**
- 大交易的风险管理
- 在大仓位上缩小规模
- 对大订单的保守方法

## 安全限制

安全限制保护您的资金并防止过度风险敞口：

### 最大订单大小

**目的：** 防止单个订单过大

**配置：**
```env
MAX_ORDER_SIZE_USD=100.0  # 没有单个订单 > $100
```

**示例：**
- 计算的订单：$150
- 限制后：**$100**（已封顶）

---

### 最小订单大小

**目的：** 避免 gas 费用超过价值的灰尘交易

**配置：**
```env
MIN_ORDER_SIZE_USD=1.0  # 没有订单 < $1
```

**示例：**
- 计算的订单：$0.50
- 结果：订单跳过（低于最小值）

---

### 最大仓位大小

**目的：** 限制对单个市场/仓位的总风险敞口

**配置：**
```env
MAX_POSITION_SIZE_USD=500.0  # 每个仓位最大 $500
```

**示例：**
- 当前仓位：$450
- 新订单：$100
- 限制后：**$50**（减少以符合限制）

---

### 最大每日交易量

**目的：** 限制每天的总交易量

**配置：**
```env
MAX_DAILY_VOLUME_USD=1000.0  # 每天最大交易 $1000
```

**注意：** 当前已跟踪但未在执行中强制执行（计划功能）

## 交易聚合

交易聚合将多个小交易合并为更大、更高效的订单。

### 工作原理

1. **收集交易** - 小交易收集在缓冲区中
2. **按标准分组** - 相同交易者、市场、方向（买入/卖出）
3. **等待窗口** - 在时间窗口内累积交易
4. **执行聚合** - 放置单个更大的订单

### 配置

```env
TRADE_AGGREGATION_ENABLED=true
TRADE_AGGREGATION_WINDOW_SECONDS=30  # 30 秒窗口
```

### 示例

**无聚合：**
- 交易 1：$2（立即执行）
- 交易 2：$3（立即执行）
- 交易 3：$1（立即执行）
- **总 gas 费用：** 3 × gas 成本

**有聚合：**
- 交易 1：$2（缓冲）
- 交易 2：$3（缓冲）
- 交易 3：$1（缓冲）
- 30 秒后：单个订单 $6
- **总 gas 费用：** 1 × gas 成本

**好处：**
- 降低 gas 成本
- 更好的执行价格
- 减少交易数量

**何时使用：**
- 跟踪活跃交易者
- 许多小交易
- 想要优化成本

## 配置示例

### 示例 1：保守小余额

**余额：** $200
**目标：** 安全、受控的交易

```env
COPY_STRATEGY=PERCENTAGE
COPY_SIZE=5.0
TRADE_MULTIPLIER=1.0
MAX_ORDER_SIZE_USD=20.0
MIN_ORDER_SIZE_USD=1.0
MAX_POSITION_SIZE_USD=50.0
TRADE_AGGREGATION_ENABLED=true
```

**结果：**
- 复制交易者订单的 5%
- 每个订单最大 $20
- 每个仓位最大 $50
- 聚合小交易

---

### 示例 2：平衡中等余额

**余额：** $1000
**目标：** 平衡增长

```env
COPY_STRATEGY=PERCENTAGE
COPY_SIZE=10.0
TRADE_MULTIPLIER=1.0
MAX_ORDER_SIZE_USD=50.0
MIN_ORDER_SIZE_USD=1.0
MAX_POSITION_SIZE_USD=200.0
TRADE_AGGREGATION_ENABLED=true
```

**结果：**
- 复制交易者订单的 10%
- 每个订单最大 $50
- 每个仓位最大 $200
- 良好的风险/回报平衡

---

### 示例 3：带倍数的激进策略

**余额：** $2000
**目标：** 放大回报

```env
COPY_STRATEGY=PERCENTAGE
COPY_SIZE=10.0
TRADE_MULTIPLIER=2.0
MAX_ORDER_SIZE_USD=100.0
MIN_ORDER_SIZE_USD=1.0
MAX_POSITION_SIZE_USD=500.0
TRADE_AGGREGATION_ENABLED=false
```

**结果：**
- 复制交易者订单的 10%
- 2x 倍数 = 20% 有效
- 每个订单最大 $100
- 更快执行（无聚合）

---

### 示例 4：复杂大余额

**余额：** $5000
**目标：** 优化的风险管理

```env
COPY_STRATEGY=ADAPTIVE
COPY_SIZE=10.0
ADAPTIVE_MIN_PERCENT=5.0
ADAPTIVE_MAX_PERCENT=15.0
ADAPTIVE_THRESHOLD_USD=500.0
TIERED_MULTIPLIERS=1-10:2.0,10-100:1.0,100-500:0.5,500+:0.2
MAX_ORDER_SIZE_USD=100.0
MIN_ORDER_SIZE_USD=1.0
MAX_POSITION_SIZE_USD=1000.0
TRADE_AGGREGATION_ENABLED=true
```

**结果：**
- 自适应百分比（5-15%）
- 分层倍数
- 在大交易上缩小规模
- 复杂的风险管理

---

### 示例 5：固定金额策略

**余额：** $500
**目标：** 一致的仓位大小

```env
COPY_STRATEGY=FIXED
COPY_SIZE=25.0
MAX_ORDER_SIZE_USD=25.0
MIN_ORDER_SIZE_USD=1.0
MAX_POSITION_SIZE_USD=100.0
TRADE_AGGREGATION_ENABLED=true
```

**结果：**
- 每笔交易始终 $25
- 可预测的风险
- 简单易懂

## 推荐策略

### 小余额（< $500）

**推荐：** 保守 PERCENTAGE

```env
COPY_STRATEGY=PERCENTAGE
COPY_SIZE=5.0
MAX_ORDER_SIZE_USD=20.0
MAX_POSITION_SIZE_USD=50.0
TRADE_AGGREGATION_ENABLED=true
```

**理由：**
- 每笔交易低风险
- 保护资金
- 聚合节省 gas

---

### 中等余额（$500 - $2000）

**推荐：** 平衡 PERCENTAGE

```env
COPY_STRATEGY=PERCENTAGE
COPY_SIZE=10.0
MAX_ORDER_SIZE_USD=50.0
MAX_POSITION_SIZE_USD=200.0
TRADE_AGGREGATION_ENABLED=true
```

**理由：**
- 良好的风险/回报平衡
- 增长空间
- 高效执行

---

### 大余额（$2000+）

**推荐：** 带分层倍数的 ADAPTIVE

```env
COPY_STRATEGY=ADAPTIVE
COPY_SIZE=10.0
ADAPTIVE_MIN_PERCENT=5.0
ADAPTIVE_MAX_PERCENT=15.0
ADAPTIVE_THRESHOLD_USD=500.0
TIERED_MULTIPLIERS=1-10:2.0,10-100:1.0,100-500:0.5,500+:0.2
MAX_ORDER_SIZE_USD=100.0
MAX_POSITION_SIZE_USD=1000.0
```

**理由：**
- 优化仓位大小
- 在大交易上缩小规模
- 复杂的风险管理

## 高级配置

### 组合策略

您可以组合多个功能：

```env
# 自适应策略
COPY_STRATEGY=ADAPTIVE
COPY_SIZE=10.0
ADAPTIVE_MIN_PERCENT=5.0
ADAPTIVE_MAX_PERCENT=15.0

# 分层倍数
TIERED_MULTIPLIERS=1-10:2.0,10-100:1.0,100-500:0.5,500+:0.2

# 安全限制
MAX_ORDER_SIZE_USD=100.0
MIN_ORDER_SIZE_USD=1.0
MAX_POSITION_SIZE_USD=1000.0

# 聚合
TRADE_AGGREGATION_ENABLED=true
TRADE_AGGREGATION_WINDOW_SECONDS=30
```

### 计算流程示例

让我们追踪一个完整的计算：

**输入：**
- 交易者订单：$300
- 您的余额：$2000
- 当前仓位：$100
- 策略：ADAPTIVE（10% 基础，5-15% 范围，$500 阈值）
- 分层倍数：1-10:2.0, 10-100:1.0, 100-500:0.5, 500+:0.2
- 限制：MAX_ORDER=$100, MIN_ORDER=$1, MAX_POSITION=$1000

**步骤 1：计算自适应百分比**
- 交易者订单：$300 < $500 阈值
- 插值：~12%（在 10% 基础和 15% 最大值之间）
- 基础金额：$300 × 12% = **$36**

**步骤 2：应用分层倍数**
- 交易者订单：$300
- 层级：100-500 → 0.5x 倍数
- 应用倍数后：$36 × 0.5 = **$18**

**步骤 3：应用最大订单限制**
- $18 < $100 限制 ✓
- 金额：**$18**

**步骤 4：应用最大仓位限制**
- 当前：$100，新：$18，总计：$118
- $118 < $1000 限制 ✓
- 金额：**$18**

**步骤 5：检查余额**
- 可用：$2000 × 0.99 = $1980
- $18 < $1980 ✓
- 金额：**$18**

**步骤 6：检查最小值**
- $18 > $1 最小值 ✓
- **最终订单：$18**

## 最佳实践

### 1. 从保守开始

- 从小百分比开始（5-10%）
- 使用低倍数（1.0-1.5x）
- 设置严格限制

### 2. 监控和调整

- 定期跟踪性能
- 根据结果调整
- 逐步扩大规模

### 3. 使用安全限制

- 始终设置 MAX_ORDER_SIZE_USD
- 考虑 MAX_POSITION_SIZE_USD
- 不要跳过 MIN_ORDER_SIZE_USD

### 4. 启用聚合

- 节省 gas 成本
- 更好的执行
- 特别是对于活跃交易者

### 5. 使用模拟测试

- 在实盘交易之前使用 `simulate_profitability`
- 测试不同配置
- 比较策略

## 故障排除

### 订单太小

**问题：** 由于最小大小而跳过订单

**解决方案：**
- 降低 MIN_ORDER_SIZE_USD
- 增加 COPY_SIZE 或倍数
- 检查余额是否充足

### 订单太大

**问题：** 订单达到最大限制

**解决方案：**
- 增加 MAX_ORDER_SIZE_USD
- 降低 COPY_SIZE 或倍数
- 调整分层倍数

### 未复制交易

**问题：** 机器人未执行交易

**检查：**
- 余额充足
- 已设置授权
- 限制不太严格
- 交易者确实在交易

### 意外的订单大小

**问题：** 订单不符合预期

**调试：**
- 检查策略配置
- 验证倍数设置
- 审查限制设置
- 检查余额约束

## 摘要

跟单交易策略系统提供：

✅ **灵活的策略** - PERCENTAGE、FIXED、ADAPTIVE
✅ **智能倍数** - 单一或分层
✅ **安全限制** - 保护您的资金
✅ **交易聚合** - 优化执行
✅ **复杂逻辑** - 多步骤计算

选择符合以下条件的策略：
- 余额大小
- 风险承受能力
- 交易目标
- 经验水平

记住：从保守开始，监控性能，逐步调整！

---

有关更多信息，请参阅：
- [入门指南](入门指南.md)
- [命令参考](命令参考.md)
- [示例](示例.md)
